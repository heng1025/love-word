// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Utils from "./utils.js";
import * as Database from "./Database.js";

var dbInstance = Database.getDB(undefined);

chrome.runtime.onMessage.addListener(function (message, param, sendResponse) {
      var mType = message.type;
      var mVal = message.value;
      if (typeof mType === "number") {
        Utils.adapterTrans(mVal).then(function (ret) {
              sendResponse(ret);
              return Promise.resolve(undefined);
            });
      } else if (mType.TAG === /* HISTORY */0) {
        if (mType._0 !== 0) {
          Promise.resolve(undefined);
        } else {
          dbInstance.then(function (db) {
                return db.getFromIndex("history", "date", mVal).then(function (ret) {
                            if (!ret) {
                              db.add("history", {
                                    date: Date.now(),
                                    text: mVal
                                  }, undefined);
                            }
                            return Promise.resolve(undefined);
                          });
              });
        }
      } else {
        switch (mType._0) {
          case /* ADD */0 :
              dbInstance.then(function (db) {
                    db.add("favorite", {
                          date: Date.now(),
                          text: mVal
                        }, undefined);
                    sendResponse(true);
                    return Promise.resolve(undefined);
                  });
              break;
          case /* GET */1 :
              dbInstance.then(function (db) {
                    return db.getFromIndex("favorite", "text", mVal).then(function (ret) {
                                if (ret) {
                                  sendResponse(true);
                                } else {
                                  sendResponse(false);
                                }
                                return Promise.resolve(undefined);
                              });
                  });
              break;
          case /* DELETE */2 :
              dbInstance.then(function (db) {
                    db.getKeyFromIndex("favorite", "text", mVal).then(function (key) {
                          db.delete("favorite", key);
                          sendResponse(false);
                          return Promise.resolve(undefined);
                        });
                    return Promise.resolve(undefined);
                  });
              break;
          case /* CLEAR */3 :
              Promise.resolve(undefined);
              break;
          
        }
      }
      return true;
    });

export {
  dbInstance ,
}
/* dbInstance Not a pure module */
