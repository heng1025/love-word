// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Widget from "../components/Widget.js";
import * as FavButton from "../components/FavButton.js";
import * as Functions from "../Functions.js";
import * as TranslateHook from "../hooks/TranslateHook.js";
import * as TranslateResult from "../components/TranslateResult.js";
import * as JsxRuntime from "react/jsx-runtime";

function ContentApp(props) {
  var host = props.host;
  var match = React.useState(function () {
        return "";
      });
  var setSourceText = match[1];
  var sourceText = match[0];
  var match$1 = React.useState(function () {
        return "eng";
      });
  var setSrcLang = match$1[1];
  var match$2 = React.useState(function () {
        return "0";
      });
  var setTop = match$2[1];
  var match$3 = React.useState(function () {
        return "0";
      });
  var setLeft = match$3[1];
  var match$4 = React.useState(function () {
        return "0";
      });
  var setOpactity = match$4[1];
  var opacity = match$4[0];
  var match$5 = TranslateHook.useTranslate(sourceText);
  var data = match$5.data;
  React.useEffect((function () {
          var handleKeyup = function (ev) {
            if (ev.keyCode !== 18) {
              return ;
            }
            var selection = window.getSelection();
            var text = selection.toString().trim();
            if (!(selection.rangeCount > 0 && text !== "")) {
              return ;
            }
            var range = selection.getRangeAt(0);
            var sl = Functions.getSourceLang(text);
            setSrcLang(function (param) {
                  return sl;
                });
            setSourceText(function (param) {
                  return text;
                });
            var rect = range.getBoundingClientRect();
            var top = rect.top + rect.height + window.scrollY;
            var left = rect.left + window.scrollX;
            setTop(function (_p) {
                  return (top + 8.0).toString() + "px";
                });
            setLeft(function (_p) {
                  return left.toString() + "px";
                });
            var match = Functions.debounce(200, (function () {
                    setOpactity(function (_p) {
                          return "1";
                        });
                  }));
            match[0]();
          };
          window.addEventListener("keyup", handleKeyup);
          return (function () {
                    window.removeEventListener("keyup", handleKeyup);
                  });
        }), []);
  React.useEffect((function () {
          var handleClick = function (e) {
            e.stopPropagation();
            if (opacity === "1" && !host.contains(e.target)) {
              setTop(function (param) {
                    return "0";
                  });
              setLeft(function (param) {
                    return "0";
                  });
              setOpactity(function (_p) {
                    return "0";
                  });
              return setSourceText(function (param) {
                          return "";
                        });
            }
            
          };
          window.addEventListener("click", handleClick);
          return (function () {
                    window.removeEventListener("click", handleClick);
                  });
        }), [opacity]);
  var mouseState = React.useMemo((function () {
          if (opacity === "1") {
            return "pointer-events-auto select-auto";
          } else {
            return "pointer-events-none select-none";
          }
        }), [opacity]);
  var style = {
    left: match$3[0],
    top: match$2[0],
    opacity: opacity
  };
  var tmp;
  switch (match$1[0]) {
    case "cmn" :
        tmp = JsxRuntime.jsx(Widget.Zh2en.make, {});
        break;
    case "eng" :
        tmp = JsxRuntime.jsx(Widget.En2zh.make, {});
        break;
    default:
      tmp = null;
  }
  var tmp$1;
  tmp$1 = data !== undefined && data.TAG === "Ok" ? JsxRuntime.jsx(FavButton.make, {
          text: sourceText,
          trans: data._0
        }) : null;
  return JsxRuntime.jsx("div", {
              children: JsxRuntime.jsx("div", {
                    children: JsxRuntime.jsxs("div", {
                          children: [
                            JsxRuntime.jsxs("h4", {
                                  children: [
                                    JsxRuntime.jsx("span", {
                                          children: tmp
                                        }),
                                    JsxRuntime.jsxs("div", {
                                          children: [
                                            tmp$1,
                                            JsxRuntime.jsx(Widget.Link.make, {
                                                  children: JsxRuntime.jsx(Widget.Jump.make, {}),
                                                  href: "https://fanyi.baidu.com/#en/zh/" + sourceText
                                                })
                                          ],
                                          className: "flex items-center"
                                        })
                                  ],
                                  className: "card-title text-sm border-b justify-between"
                                }),
                            JsxRuntime.jsx(TranslateResult.make, {
                                  loading: match$5.loading,
                                  data: data,
                                  delay: 200,
                                  className: "text-sm"
                                })
                          ],
                          className: "card-body p-3"
                        }),
                    className: "card w-52 bg-primary text-primary-content"
                  }),
              className: "absolute z-[99999] " + mouseState,
              style: style
            });
}

var panelDelay = 200;

var make = ContentApp;

export {
  panelDelay ,
  make ,
}
/* react Not a pure module */
