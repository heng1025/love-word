// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as RecordAction from "./RecordAction.js";

function includeWith(target, substring) {
  return new RegExp(substring).test(target);
}

function $$History(Props) {
  var match = React.useState(function () {
        return [];
      });
  var setRecords = match[1];
  var records = match[0];
  var getAll = function (param) {
    chrome.runtime.sendMessage({
            _type: {
              TAG: /* HISTORY */0,
              _0: /* GETALL */2
            }
          }).then(function (ret) {
          var rs = ret.map(function (v) {
                v.checked = false;
                return v;
              });
          setRecords(function (param) {
                return rs;
              });
        });
  };
  React.useEffect((function () {
          getAll(undefined);
        }), []);
  var onSearch = function (val) {
    if (val === "") {
      return getAll(undefined);
    }
    var rs = records.filter(function (item) {
          var target = item.text;
          return new RegExp(val).test(target);
        });
    setRecords(function (param) {
          return rs;
        });
  };
  var onDelete = function (checkedRecords) {
    chrome.runtime.sendMessage({
            _type: {
              TAG: /* HISTORY */0,
              _0: /* DELETE */3
            },
            date: checkedRecords.map(function (v) {
                  return v.date;
                })
          }).then(function (param) {
          getAll(undefined);
        });
  };
  var onClear = function () {
    chrome.runtime.sendMessage({
            _type: {
              TAG: /* HISTORY */0,
              _0: /* CLEAR */4
            }
          }).then(function (param) {
          getAll(undefined);
        });
  };
  var recordEles = records.sort(function (v1, v2) {
          return v2.date - v1.date | 0;
        }).map(function (v) {
        var date = v.date;
        var boarderClass = v.checked ? "border-primary" : "";
        return React.createElement("div", {
                    key: date.toString(),
                    className: "card card-compact card-bordered cursor-pointer bg-base-100 shadow-xl " + boarderClass + "",
                    onClick: (function (param) {
                        var rs = records.map(function (v$1) {
                              var date = v.date;
                              var checked = v.checked;
                              if (date === v$1.date) {
                                v$1.checked = !checked;
                              }
                              return v$1;
                            });
                        setRecords(function (param) {
                              return rs;
                            });
                      })
                  }, React.createElement("div", {
                        className: "card-body"
                      }, React.createElement("div", {
                            className: "flex justify-between"
                          }, React.createElement("span", undefined, new Date(date).toLocaleString()), React.createElement("a", {
                                className: "inline-flex gap-2",
                                href: v.url,
                                target: "_blank"
                              }, React.createElement("span", undefined, v.title), React.createElement("img", {
                                    className: "w-5",
                                    src: v.favIconUrl
                                  }))), React.createElement("p", {
                            className: "font-bold text-xl"
                          }, v.text)));
      });
  return React.createElement("div", undefined, React.createElement(RecordAction.make, {
                  className: "mb-4",
                  records: records.filter(function (v) {
                        return v.checked;
                      }),
                  onDelete: onDelete,
                  onClear: onClear,
                  onSearch: onSearch
                }), React.createElement("div", {
                  className: "flex flex-col gap-4"
                }, recordEles));
}

var make = $$History;

export {
  includeWith ,
  make ,
}
/* react Not a pure module */
